import sys
import json
from PyQt5.QtWidgets import (
    QApplication, QWidget, QLabel, QSpinBox, QPushButton,
    QVBoxLayout, QScrollArea, QMessageBox, QFileDialog, QInputDialog
)

class BelirtecPenceresi(QWidget):
    def __init__(self, belirtec_adi, sorular, max_puan, callback):
        super().__init__()
        self.setWindowTitle(belirtec_adi)
        self.setGeometry(200, 200, 600, 700)

        self.belirtec_adi = belirtec_adi
        self.sorular = sorular
        self.max_puan = max_puan
        self.callback = callback
        self.spinboxes = []

        self.initUI()

    def initUI(self):
        main_layout = QVBoxLayout()
        main_layout.addWidget(QLabel(f"{self.belirtec_adi} - Her soruya (-5) ve (5) arasÄ± puan giriniz."))

        scroll_area = QScrollArea()
        inner_widget = QWidget()
        inner_layout = QVBoxLayout()

        for soru in self.sorular:
            inner_layout.addWidget(QLabel(soru))
            spin = QSpinBox()
            spin.setRange(-5, 5)
            self.spinboxes.append((soru, spin))
            inner_layout.addWidget(spin)

        inner_widget.setLayout(inner_layout)
        scroll_area.setWidget(inner_widget)
        scroll_area.setWidgetResizable(True)
        main_layout.addWidget(scroll_area)

        btn = QPushButton("Kaydet ve Kapat")
        btn.clicked.connect(self.devam_et)
        main_layout.addWidget(btn)
        self.setLayout(main_layout)

    def devam_et(self):
        puanlar = {soru: spin.value() for soru, spin in self.spinboxes}
        puan_toplam = sum(puanlar.values())
        max_soru_puan = len(self.spinboxes) * 5
        oran = puan_toplam / max_soru_puan if max_soru_puan > 0 else 0
        katkilar = round(oran * self.max_puan, 2)

        # callback'e tÃ¼m sorular + puanlar + toplam gÃ¶nderiyoruz
        self.callback(self.belirtec_adi, katkilar, puanlar)
        self.close()


class KatsayiHesaplayici(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("FMS TanÄ± Skoru HesaplayÄ±cÄ±")
        self.setGeometry(200, 200, 500, 400)

        self.max_puanlar = {
            'K1_miR_145_5p(-)': 35,
            'K2_miR_223_3p(-)': 25,
            'K3_H2O2(+)': 15,
            'K4_BDNF(+)': 15,
            'K5_CoQ10(-)': 10
        }

        self.sorular = {
    'K1_miR_145_5p(-)': [
        "Ä°ÅŸlenmiÅŸ gÄ±da ve trans yaÄŸ tÃ¼ketimi (etki: azaltÄ±r, puan: 9)",
        "Bitki bazlÄ±, anti-inflamatuvar beslenme (zeytinyaÄŸÄ±, kurkumin, zencefil) (etki: artÄ±rÄ±r, puan: 8)",
        "Radyasyona maruz kalma (MR, rÃ¶ntgen, gÃ¼neÅŸ, ekran) (etki: azaltÄ±r, puan: 7)",
        "Uzun sÃ¼reli antibiyotik kullanÄ±mÄ± geÃ§miÅŸi (etki: azaltÄ±r, puan: 7)",
        "DoÄŸal iÃ§erikli temizlik ve kozmetik Ã¼rÃ¼n kullanÄ±mÄ± (etki: artÄ±rÄ±r, puan: 6)",
        "Hareketsiz yaÅŸam (etki: azaltÄ±r, puan: 8)",
        "DÃ¼zenli detoks (su, terleme, sauna) (etki: artÄ±rÄ±r, puan: 7)",
        "Glukozinolat iÃ§eren sebze tÃ¼ketimi (brokoli, lahana, turp) (etki: artÄ±rÄ±r, puan: 9)",
        "Selenyum ve Ã§inko takviyesi (etki: artÄ±rÄ±r, puan: 6)",
        "Elektromanyetik alanlara yoÄŸun maruz kalma (Bluetooth, Wi-Fi) (etki: azaltÄ±r, puan: 6)",
        "Kimyasal iÃ§erikli kozmetik veya temizlik Ã¼rÃ¼nleri kullanÄ±mÄ± (etki: azaltÄ±r, puan: 7)",
        "Sigara dumanÄ±na maruziyet (aktif/pasif) (etki: azaltÄ±r, puan: 9)",
        "YÃ¼ksek dÃ¼zeyde stres (etki: azaltÄ±r, puan: 9)",
        "Kronik uyku bozukluÄŸu / yetersizliÄŸi (etki: azaltÄ±r, puan: 8)",
        "AÅŸÄ±rÄ± protein alÄ±mÄ± (etki: azaltÄ±r, puan: 6)",
        "AÅŸÄ±rÄ± tuz tÃ¼ketimi (etki: azaltÄ±r, puan: 7)",
        "Evcil hayvanla vakit geÃ§irmek (etki: artÄ±rÄ±r, puan: 6)",
        "AÅŸÄ±rÄ± rekabet ortamÄ±nda yaÅŸamak (okul, sÄ±nav stresi, aile baskÄ±sÄ±) (etki: azaltÄ±r, puan: 8)",
        "DoÄŸadan uzak ÅŸehir yaÅŸamÄ± (etki: azaltÄ±r, puan: 7)",
        "AÅŸÄ±rÄ± mÃ¼kemmeliyetÃ§i veya takÄ±ntÄ±lÄ± davranÄ±ÅŸlar (etki: azaltÄ±r, puan: 7)",
        "Probiyotik ve prebiyotik aÃ§Ä±sÄ±ndan zengin beslenme (etki: artÄ±rÄ±r, puan: 8)",
        "Akdeniz diyeti uygulamak (etki: artÄ±rÄ±r, puan: 9)",
        "Uzun sÃ¼reli aÃ§lÄ±k / aralÄ±klÄ± oruÃ§ (etki: artÄ±rÄ±r, puan: 7)",
        "D vitamini eksikliÄŸi (etki: azaltÄ±r, puan: 7)",
        "Sirkadiyen ritim bozukluklarÄ± (vardiya, jetlag) (etki: azaltÄ±r, puan: 8)",
        "Ekran Ä±ÅŸÄ±ÄŸÄ±na baÄŸlÄ± melatonin baskÄ±lanmasÄ± (etki: azaltÄ±r, puan: 6)",
        "YÃ¼ksek ÅŸeker / glikoz tÃ¼ketimi (etki: azaltÄ±r, puan: 8)"
    ],
    'K2_miR_223_3p(-)': [
        "AÅŸÄ±rÄ± yaÄŸlÄ± ve iÅŸlenmiÅŸ gÄ±dalar tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 9)",
        "Omega-3 aÃ§Ä±sÄ±ndan zengin gÄ±da tÃ¼ketimi (balÄ±k, keten tohumu) (etki: azaltÄ±r, puan: 7)",
        "Antioksidan aÃ§Ä±sÄ±ndan zengin beslenme (etki: azaltÄ±r, puan: 6)",
        "Gece geÃ§ saatlerde mavi Ä±ÅŸÄ±ÄŸa maruz kalma (etki: artÄ±rÄ±r, puan: 7)",
        "SÃ¼rekli stres altÄ±nda kalma (etki: artÄ±rÄ±r, puan: 9)",
        "DÃ¼zenli uyku (etki: azaltÄ±r, puan: 7)",
        "DÃ¼zenli egzersiz (etki: azaltÄ±r, puan: 8)",
        "Hareketsiz masa baÅŸÄ± yaÅŸam (etki: artÄ±rÄ±r, puan: 8)",
        "Temiz, yeÅŸil alanlarda vakit geÃ§irme (etki: azaltÄ±r, puan: 6)",
        "SÃ¼rekli aÃ§ kalmak ve dÃ¼ÅŸÃ¼k kalorili diyetler (etki: azaltÄ±r, puan: 7)",
        "Derin nefes alma alÄ±ÅŸkanlÄ±ÄŸÄ± (etki: azaltÄ±r, puan: 5)",
        "TarÄ±m ilaÃ§larÄ±na maruz kalma (etki: artÄ±rÄ±r, puan: 8)",
        "AÅŸÄ±rÄ± sosyal medya kullanÄ±mÄ± (etki: artÄ±rÄ±r, puan: 6)",
        "SÃ¼t ve sÃ¼t Ã¼rÃ¼nleri tÃ¼ketmeme (vegan diyet) (etki: azaltÄ±r, puan: 5)",
        "SÄ±k sÄ±k fast food tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 9)",
        "DÃ¼zenli probiyotik takviyesi (etki: azaltÄ±r, puan: 6)",
        "Haftada en az 2 kez iÅŸlenmiÅŸ et (sosis, salam vb.) tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 8)",
        "AÄŸÄ±r metallere maruz kalmak (etki: artÄ±rÄ±r, puan: 9)",
        "DÃ¼zenli kuruyemiÅŸ (ceviz, badem vs.) tÃ¼ketimi (etki: azaltÄ±r, puan: 6)",
        "Ã‡ok sÄ±k tatlÄ± tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 7)"
    ],
    'K3_H2O2(+)': [
        "AÅŸÄ±rÄ± alkol tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 9)",
        "YÃ¼ksek yaÄŸlÄ± veya yÃ¼ksek karbonhidratlÄ± beslenme (etki: artÄ±rÄ±r, puan: 8)",
        "Aktif ya da pasif sigaraya maruz kalmak (etki: artÄ±rÄ±r, puan: 10)",
        "Yeterli ve dengeli beslenmek (etki: azaltÄ±r, puan: 9)",
        "Yeterli ve dÃ¼zenli uyku (etki: azaltÄ±r, puan: 9)",
        "GÃ¼neÅŸ koruyucu kullanÄ±mÄ± (etki: azaltÄ±r, puan: 7)",
        "Antioksidan bakÄ±mÄ±ndan zengin besin tÃ¼ketimi (etki: azaltÄ±r, puan: 9)",
        "GÃ¼nlÃ¼k yaÅŸamda sÃ¼rekli strese maruz kalmak (etki: artÄ±rÄ±r, puan: 9)",
        "Dengeli ve dÃ¼zenli egzersiz (etki: azaltÄ±r, puan: 8)",
        "Radyasyona maruz kalmak (etki: artÄ±rÄ±r, puan: 8)",
        "AÅŸÄ±rÄ± egzersiz (etki: artÄ±rÄ±r, puan: 7)",
        "Genetik yatkÄ±nlÄ±k (etki: artÄ±rÄ±r, puan: 6)",
        "YoÄŸun hava kirliliÄŸine maruz kalma (etki: artÄ±rÄ±r, puan: 9)",
        "Åekerli iÃ§ecekler veya yÃ¼ksek ÅŸeker tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 8)",
        "Kimyasallara sÄ±k sÄ±k maruz kalma (etki: artÄ±rÄ±r, puan: 8)",
        "Su tÃ¼ketimi (etki: azaltÄ±r, puan: 7)",
        "SÄ±k sÄ±k iltihaplanma veya enfeksiyon yaÅŸama (etki: artÄ±rÄ±r, puan: 8)",
        "VÃ¼cut kitle indeksinin saÄŸlÄ±klÄ± aralÄ±kta olmasÄ± (etki: azaltÄ±r, puan: 9)",
        "Ekran sÃ¼resi (etki: artÄ±rÄ±r, puan: 7)",
        "SÄ±k sÄ±k antibiyotik veya ilaÃ§ kullanÄ±mÄ± (etki: artÄ±rÄ±r, puan: 7)",
        "DÃ¼zenli meditasyon, dua ya da nefes egzersizleri (etki: azaltÄ±r, puan: 8)",
        "Sosyal izolasyon ve toksik iliÅŸkiler (etki: artÄ±rÄ±r, puan: 7)",
        "Kafeinli iÃ§ecek tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 6)",
        "Obezite ve aÅŸÄ±rÄ± yaÄŸ dokusu varlÄ±ÄŸÄ± (etki: artÄ±rÄ±r, puan: 9)",
        "Kronik inflamatuar hastalÄ±klar (romatoid artrit, IBS vb.) (etki: artÄ±rÄ±r, puan: 8)",
        "Sigara dumanÄ± maruziyeti (pasif dahi olsa) (etki: artÄ±rÄ±r, puan: 9)",
        "Yetersiz antioksidan enzim aktivitesi (Ã¶r: SOD, katalaz dÃ¼ÅŸÃ¼klÃ¼ÄŸÃ¼) (etki: artÄ±rÄ±r, puan: 8)",
        "YÃ¼ksek doz vitamin C ve E takviyesi (bazÄ± durumlarda pro-oksidan etkili) (etki: artÄ±rÄ±r, puan: 5)",
        "Kronik uyku eksikliÄŸi (etki: artÄ±rÄ±r, puan: 8)",
        "Ã‡evresel toksinlere (kurÅŸun, cÄ±va, arsenik) maruz kalma (etki: artÄ±rÄ±r, puan: 9)"
    ],
    'K4_BDNF(+)': [
        "Depresyon veya anksiyete gibi ruh hali bozukluklarÄ± (etki: azaltÄ±r, puan: 10)",
        "DÃ¼zenli olarak aÃ§Ä±k havada yÃ¼rÃ¼yÃ¼ÅŸ (etki: artÄ±rÄ±r, puan: 9)",
        "Ekran sÃ¼resinin 5+ saat olmasÄ± (etki: azaltÄ±r, puan: 8)",
        "Meditasyon, nefes egzersizi gibi zihin sakinleÅŸtirici alÄ±ÅŸkanlÄ±klar (etki: artÄ±rÄ±r, puan: 8)",
        "Ã‡ikolata tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 6)",
        "YeÅŸil Ã§ay veya zerdeÃ§al tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 7)",
        "Hareketsizlik (etki: azaltÄ±r, puan: 9)",
        "Monoton iÅŸlerle meÅŸgul olmak (etki: azaltÄ±r, puan: 7)",
        "NÃ¶rolojik hastalÄ±k geÃ§miÅŸi (Alzheimer, depresyon, ÅŸizofreni) (etki: azaltÄ±r, puan: 10)",
        "AralÄ±klÄ± oruÃ§ uygulamak (etki: artÄ±rÄ±r, puan: 8)",
        "DÃ¼zenli ve aÅŸÄ±rÄ± alkol tÃ¼ketimi (etki: azaltÄ±r, puan: 9)",
        "Yeni ÅŸeyler Ã¶ÄŸrenmeye Ã§alÄ±ÅŸmak (etki: artÄ±rÄ±r, puan: 9)",
        "Lif aÃ§Ä±sÄ±ndan zayÄ±f beslenme (etki: azaltÄ±r, puan: 7)",
        "AÅŸÄ±rÄ± gÃ¼rÃ¼ltÃ¼lÃ¼, kaotik ortamda yaÅŸamak (etki: azaltÄ±r, puan: 8)",
        "KapalÄ± ortamda uzun sÃ¼re kalmak (Ä±ÅŸÄ±k gÃ¶rmemek) (etki: azaltÄ±r, puan: 8)",
        "SÃ¼rekli acele iÃ§inde yaÅŸamak (etki: azaltÄ±r, puan: 7)",
        "DoÄŸayla dÃ¼zenli temas (toprak, yÃ¼rÃ¼yÃ¼ÅŸ, Ã§iÃ§ek ekme) (etki: artÄ±rÄ±r, puan: 8)",
        "AlÃ¼minyum veya plastik kapta sÄ±cak yemek yemek (etki: azaltÄ±r, puan: 7)",
        "Dengeli ve dÃ¼zenli uyku (etki: artÄ±rÄ±r, puan: 9)",
        "YÃ¼ksek oranda fruktoz ve ÅŸekerli gÄ±da tÃ¼ketimi (etki: azaltÄ±r, puan: 8)",
        "Omega-3 tÃ¼ketimi (DHA, EPA) (etki: artÄ±rÄ±r, puan: 9)",
        "ZenginleÅŸtirilmiÅŸ Ã§evrede bulunma (sanat, mÃ¼zik, doÄŸa) (etki: artÄ±rÄ±r, puan: 9)",
        "YÃ¼ksek insÃ¼lin seviyeleri (hiperinsÃ¼linemi) (etki: azaltÄ±r, puan: 7)",
        "YÃ¼ksek D vitamini dÃ¼zeyi (etki: artÄ±rÄ±r, puan: 8)",
        "Kronik inflamasyon (yÃ¼ksek CRP, IL-6 vs.) (etki: azaltÄ±r, puan: 8)",
        "Kafeinli iÃ§eceklerin aÅŸÄ±rÄ± tÃ¼ketimi (etki: azaltÄ±r, puan: 6)",
        "YÃ¼ksek entelektÃ¼el uyarÄ±m (kitap, dil Ã¶ÄŸrenme, problem Ã§Ã¶zme) (etki: artÄ±rÄ±r, puan: 9)"
    ],  
    'K5_CoQ10(-)': [
        "CoQ10 aÃ§Ä±sÄ±ndan zengin gÄ±da tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 9)",
        "CoQ10 takviyesi alÄ±mÄ± (etki: artÄ±rÄ±r, puan: 10)",
        "Dengeli ve dÃ¼zenli beslenme (etki: artÄ±rÄ±r, puan: 8)",
        "Ã‡ok yoÄŸun ve uzun sÃ¼reli egzersiz (etki: azaltÄ±r, puan: 7)",
        "Enerjik olma dÃ¼zeyi (etki: artÄ±rÄ±r, puan: 7)",
        "Trans yaÄŸ ve iÅŸlenmiÅŸ gÄ±da tÃ¼ketimi (etki: azaltÄ±r, puan: 8)",
        "Kolesterol dÃ¼ÅŸÃ¼rÃ¼cÃ¼ statin grubu ilaÃ§ kullanÄ±mÄ± (etki: azaltÄ±r, puan: 10)",
        "Fermente gÄ±da tÃ¼ketimi (yoÄŸurt, kefir, turÅŸu) (etki: artÄ±rÄ±r, puan: 7)",
        "KahvaltÄ±yÄ± atlamak (etki: azaltÄ±r, puan: 7)",
        "GÃ¼neÅŸten doÄŸal D vitamini alÄ±mÄ± (etki: artÄ±rÄ±r, puan: 8)",
        "Mide problemi / reflÃ¼ / emilim bozukluÄŸu (etki: azaltÄ±r, puan: 8)",
        "Vegan veya vejeteryan beslenme (etki: azaltÄ±r, puan: 7)",
        "DoÄŸum kontrol hapÄ±, antidepresan veya kortizon kullanÄ±mÄ± (etki: azaltÄ±r, puan: 7)",
        "Bitkisel yaÄŸ (zeytinyaÄŸÄ±, avokado yaÄŸÄ±) tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 7)",
        "AÅŸÄ±rÄ± dÃ¼ÅŸÃ¼k kalorili diyet (etki: azaltÄ±r, puan: 8)",
        "Omega-3 tÃ¼ketimi (etki: artÄ±rÄ±r, puan: 8)",
        "Sigara ya da alkol tÃ¼ketimi (etki: azaltÄ±r, puan: 9)",
        "Antioksidan iÃ§eren yiyecek tÃ¼ketimi (yaban mersini, yeÅŸil Ã§ay, kakao, ceviz) (etki: artÄ±rÄ±r, puan: 8)",
        "GÄ±da boyasÄ±, katkÄ± maddesi, yapay tatlandÄ±rÄ±cÄ± kullanÄ±mÄ± (etki: azaltÄ±r, puan: 7)",
        "GÃ¼nlÃ¼k parfÃ¼m, deodorant, vÃ¼cut spreyi kullanÄ±mÄ± (etki: azaltÄ±r, puan: 6)",
        "AynÄ± anda birden fazla ÅŸey dÃ¼ÅŸÃ¼nmek (etki: azaltÄ±r, puan: 6)",
        "Paraben, sÃ¼lfat, ftalat iÃ§eren kozmetik Ã¼rÃ¼n kullanÄ±mÄ± (etki: azaltÄ±r, puan: 7)",
        "YaÅŸlanma (etki: azaltÄ±r, puan: 9)",
        "Mitokondriyal fonksiyon bozukluÄŸu (etki: azaltÄ±r, puan: 8)",
        "Kronik inflamasyon (etki: azaltÄ±r, puan: 7)",
        "AÅŸÄ±rÄ± stres ve kortizol yÃ¼ksekliÄŸi (etki: azaltÄ±r, puan: 7)",
        "BazÄ± antibiyotiklerin uzun sÃ¼reli kullanÄ±mÄ± (etki: azaltÄ±r, puan: 6)",
        "Yetersiz uyku kalitesi (etki: azaltÄ±r, puan: 7)",
        "YÃ¼ksek kafein tÃ¼ketimi (etki: azaltÄ±r, puan: 5)"
    ]
}

        # sonuÃ§larÄ± saklamak iÃ§in
        self.katkilar = {}
        self.detaylar = {}
        self.acik_pencereler = {}

        layout = QVBoxLayout()
        layout.addWidget(QLabel("Her belirteÃ§ iÃ§in ilgili butona tÄ±klayarak puanlarÄ± giriniz:"))
        layout.addWidget(QLabel("KullanÄ±cÄ±lar iÃ§in uyarÄ±1: AzaltÄ±cÄ± Ã¶zelliÄŸe sahip olanlar zaten baÄŸÄ±msÄ±z bir duruma iÅŸaret edebileceÄŸi iÃ§in negatif deÄŸer verilerek girilmelidir!"))
        layout.addWidget(QLabel("KullanÄ±cÄ±lar iÃ§in uyarÄ±2: Her soru belirteci eÅŸit miktarda bir Ã¶neme sahip olmadÄ±ÄŸÄ± iÃ§in o soruya verilecek paun 5 Ã¼zerinden deÄŸil yanÄ±nda yazan 10 Ã¼zerinden Ã¶nem puanÄ±n yarÄ±sÄ± olacak kadardÄ±r!"))
        layout.addWidget(QLabel("Ã–rnek olarak Ã¶nem puanÄ± 10 olan bir arttÄ±rÄ±cÄ± Ã¶zellikteki bir puan iÃ§in maksimum 5 dir ancak 6 olan biri iÃ§in 3 maksimum puandÄ±r!"))
        layout.addWidget(QLabel("Mir145-5p ve Mir223-3p Ã¼st dÃ¼zey bir etkinlikte olduÄŸundan eÄŸer hastada yapÄ±lan spektrometrik test sonucuna gÃ¶re o belirtece ait genetik sorularÄ±n puanÄ± Ã¶nem farketmeksizin aynÄ± eÅŸit ve vÃ¼cuttaki miktarÄ±na gÃ¶re verilmelidir!"))
        layout.addWidget(QLabel("UyarÄ±: Negatif kolerasyon gÃ¶sterenlerin puanlamasÄ± pozitif korelasyon gÃ¶sterenlerle gÃ¶re tam tersi yani pozitif olan negatif, negatif olan pozitif olacak ÅŸekilde olacaktÄ±r!"))
        layout.addWidget(QLabel("Belirtecin kolerasyonu belirteÃ§ butonlarÄ± Ã¼zerinde + veya - ile, kendi sayfalarÄ±nda yazÄ± ile belirtilmiÅŸtir"))

        for belirtec in self.sorular:
            btn = QPushButton(belirtec)
            btn.clicked.connect(lambda checked, b=belirtec: self.belirtec_penceresi_ac(b))
            layout.addWidget(btn)

        hesap_btn = QPushButton("FMS skorunu hesapla ve tanÄ± koy.")
        hesap_btn.clicked.connect(self.skoru_goster)
        layout.addWidget(hesap_btn)

        self.setLayout(layout)

    def belirtec_penceresi_ac(self, belirtec):
        pencere = BelirtecPenceresi(
            belirtec_adi=belirtec,
            sorular=self.sorular[belirtec],
            max_puan=self.max_puanlar[belirtec],
            callback=self.sonucu_kaydet
        )
        self.acik_pencereler[belirtec] = pencere
        pencere.show()

    def sonucu_kaydet(self, belirtec, deger, puanlar):
        self.katkilar[belirtec] = deger
        self.detaylar[belirtec] = {
            "sorular": puanlar,
            "katki": deger,
            "max_puan": self.max_puanlar[belirtec]
        }

    def skoru_goster(self):
        if len(self.katkilar) < len(self.max_puanlar):
            QMessageBox.warning(self, "Eksik Girdi", "LÃ¼tfen tÃ¼m belirteÃ§lerin puanlarÄ±nÄ± giriniz.")
            return
        hasta_notu, ok = QInputDialog.getText(self, "Hasta AÃ§Ä±klamasÄ±", "LÃ¼tfen hasta iÃ§in ek aÃ§Ä±klama giriniz:")
        if not ok:
            hasta_notu = ""

        toplam = round(sum(self.katkilar.values()), 2)

        # JSON verisi hazÄ±rla
        data = {
            "belirtecler": self.detaylar,
            "toplam_skor": toplam,
            "max_skor": 100
        }
        data = {
    "hasta_notu": hasta_notu,
    "belirtecler": self.detaylar,
    "toplam_skor": toplam,
    "max_skor": 100
}


        # Dosya kaydetme penceresi aÃ§
        dosya_adi, _ = QFileDialog.getSaveFileName(self, "JSON DosyasÄ± Kaydet", "", "JSON Files (*.json)")
        if dosya_adi:
            with open(dosya_adi, "w", encoding="utf-8") as f:
                json.dump(data, f, indent=4, ensure_ascii=False)

        # ekranda gÃ¶ster
        sonuc = "ğŸ“Š BelirteÃ§ KatkÄ±larÄ±:\n"
        for k, v in self.katkilar.items():
            sonuc += f"{k}: {v} / {self.max_puanlar[k]}\n"
        sonuc += f"\nğŸ¯ Toplam FMS Skoru: {toplam} / 100\n"
        QMessageBox.information(self, "FMS SonuÃ§", sonuc)


if __name__ == "__main__":
    app = QApplication(sys.argv)
    pencere = KatsayiHesaplayici()
    pencere.show()
    sys.exit(app.exec_())

GeliÅŸtirilmiÅŸ ana test kodu: import sys
import sys
import json
from PyQt5.QtWidgets import (
    QApplication, QWidget, QLabel, QSpinBox, QPushButton,
    QVBoxLayout, QLineEdit, QComboBox, QMessageBox, QFileDialog
)

class FMSBirlesik(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("FMS TeÅŸhis AracÄ± (Ã–lÃ§Ã¼m + Anket + Hasta Bilgileri)")
        self.setGeometry(300, 300, 500, 700)
        layout = QVBoxLayout()

        # Hasta Bilgileri
        layout.addWidget(QLabel("ğŸ‘¤ Hasta Bilgileri"))
        self.ad = QLineEdit()
        layout.addWidget(QLabel("Ad:"))
        layout.addWidget(self.ad)
        self.soyad = QLineEdit()
        layout.addWidget(QLabel("Soyad:"))
        layout.addWidget(self.soyad)
        self.dogum_tarihi = QLineEdit()
        layout.addWidget(QLabel("DoÄŸum Tarihi (GG/AA/YYYY):"))
        layout.addWidget(self.dogum_tarihi)
        self.yas = QSpinBox()
        self.yas.setRange(0, 120)
        layout.addWidget(QLabel("YaÅŸ:"))
        layout.addWidget(self.yas)
        self.medeni = QComboBox()
        self.medeni.addItems(["Bekar", "Evli", "DiÄŸer"])
        layout.addWidget(QLabel("Medeni Durum:"))
        layout.addWidget(self.medeni)

        # Belirtec Ã–lÃ§Ã¼mleri
        layout.addWidget(QLabel("\nğŸ§¬ Belirtec Ã–lÃ§Ã¼m DeÄŸerlerini Giriniz"))
        self.miR145 = QSpinBox()
        self.miR145.setRange(0, 40)
        layout.addWidget(QLabel("miR-145-5p (max 40)-:"))
        layout.addWidget(self.miR145)
        self.miR223 = QSpinBox()
        self.miR223.setRange(0, 30)
        layout.addWidget(QLabel("miR-223-3p (max 30)-:"))
        layout.addWidget(self.miR223)
        self.bdnf = QSpinBox()
        self.bdnf.setRange(0, 12)
        layout.addWidget(QLabel("BDNF (max 12)+:"))
        layout.addWidget(self.bdnf)
        self.h2o2 = QSpinBox()
        self.h2o2.setRange(0, 10)
        layout.addWidget(QLabel("H2O2 (max 10)+:"))
        layout.addWidget(self.h2o2)
        self.coq10 = QSpinBox()
        self.coq10.setRange(0, 8)
        layout.addWidget(QLabel("CoQ10 (max 8)-:"))
        layout.addWidget(self.coq10)

        # Anket
        layout.addWidget(QLabel("\nğŸ“ Soru-Cevap TabanlÄ± Puanlama"))
        self.anket = QSpinBox()
        self.anket.setRange(0, 100)
        layout.addWidget(QLabel("Soru cevaplara dayalÄ± toplam puan (0â€“100):"))
        layout.addWidget(self.anket)

        # Hesapla ve JSON kaydet
        hesap_btn = QPushButton("FMS Skorunu Hesapla ve JSON Kaydet")
        hesap_btn.clicked.connect(self.hesapla)
        layout.addWidget(hesap_btn)

        self.setLayout(layout)

    def hesapla(self):
        # Hasta bilgileri
        hasta_bilgi = {
            "ad": self.ad.text(),
            "soyad": self.soyad.text(),
            "dogum_tarihi": self.dogum_tarihi.text(),
            "yas": self.yas.value(),
            "medeni_durum": self.medeni.currentText()
        }

        # Belirtec Ã¶lÃ§Ã¼m deÄŸerleri
        g_mir145 = self.miR145.value()
        g_mir223 = self.miR223.value()
        g_bdnf = self.bdnf.value()
        g_h2o2 = self.h2o2.value()
        g_coq10 = self.coq10.value()
        toplam_belirtec = g_mir145 + g_mir223 + g_bdnf + g_h2o2 + g_coq10
        belirtec_etki = toplam_belirtec * 0.85

        # Soru-cevap puanÄ±
        soru_puani = self.anket.value()
        soru_etki = soru_puani * 0.15
        toplam_skor = round(belirtec_etki + soru_etki, 2)

        # TanÄ±
        if toplam_skor >= 74:
            tani = "âœ… FMS POZÄ°TÄ°F"
        else:
            tani = "âŒ FMS NEGATÄ°F"

        # JSON formatÄ±nda veri
        veri = {
            "hasta_bilgileri": hasta_bilgi,
            "belirtec_puanlari": {
                "miR-145-5p": g_mir145,
                "miR-223-3p": g_mir223,
                "BDNF": g_bdnf,
                "H2O2": g_h2o2,
                "CoQ10": g_coq10,
                "toplam": toplam_belirtec,
                "katkisi": round(belirtec_etki, 2)
            },
            "anket_puani": {
                "puan": soru_puani,
                "katkisi": round(soru_etki, 2)
            },
            "toplam_fms_skoru": toplam_skor,
            "tani": tani
        }

        # JSON kaydetme
        dosya_yolu, _ = QFileDialog.getSaveFileName(self, "JSON Kaydet", "", "JSON Files (*.json)")
        if dosya_yolu:
            with open(dosya_yolu, "w", encoding="utf-8") as f:
                json.dump(veri, f, ensure_ascii=False, indent=4)

        # SonuÃ§ mesajÄ±
        sonuc = f"ğŸ¯ TOPLAM FMS SKORU: {toplam_skor} / 100\n{tani}"
        QMessageBox.information(self, "FMS SonuÃ§", sonuc)

if __name__ == "__main__":
    app = QApplication(sys.argv)
    pencere = FMSBirlesik()
    pencere.show()
    sys.exit(app.exec_())

    pencere = FMSBirlesik()
    pencere.show()
    sys.exit(app.exec_())
